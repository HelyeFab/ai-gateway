version: '3'

services:
  # Use a simple mock image service for now
  image-mock:
    image: python:3.10-slim
    container_name: ai-gateway-image-mock
    ports:
      - "7860:7860"
    command: |
      sh -c "pip install flask flask-cors pillow && python -c \"
      from flask import Flask, request, jsonify
      from flask_cors import CORS
      import base64
      import io
      from PIL import Image
      
      app = Flask(__name__)
      CORS(app)
      
      @app.route('/sdapi/v1/txt2img', methods=['POST'])
      def txt2img():
          # Create a simple colored image as mock
          img = Image.new('RGB', (512, 512), color='purple')
          buffered = io.BytesIO()
          img.save(buffered, format='PNG')
          img_base64 = base64.b64encode(buffered.getvalue()).decode()
          
          return jsonify({
              'images': [img_base64],
              'info': 'Mock image generated'
          })
      
      @app.route('/', methods=['GET'])
      def health():
          return 'OK'
      
      app.run(host='0.0.0.0', port=7860)
      \""
    networks:
      - ai-gateway_default
    restart: unless-stopped

  # Simple whisper mock for now
  whisper-mock:
    image: python:3.10-slim
    container_name: ai-gateway-whisper-mock
    ports:
      - "8092:8092"
    command: |
      sh -c "pip install flask flask-cors && python -c \"
      from flask import Flask, request, jsonify
      from flask_cors import CORS
      
      app = Flask(__name__)
      CORS(app)
      
      @app.route('/transcribe', methods=['POST'])
      def transcribe():
          return jsonify({
              'text': 'This is a mock transcription of your audio.',
              'language': 'en'
          })
      
      @app.route('/', methods=['GET'])
      def health():
          return 'OK'
      
      app.run(host='0.0.0.0', port=8092)
      \""
    networks:
      - ai-gateway_default
    restart: unless-stopped

networks:
  ai-gateway_default:
    external: true